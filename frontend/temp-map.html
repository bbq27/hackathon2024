<!-- Using Simulated Data -->
<!DOCTYPE html>
<html>
<head>
    <title>Find That Pokemon</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #mapid {
            height: 100vh; /* Sets the height of the map to fill the viewport */
            width: 100vw; /* Sets the width of the map to fill the viewport */
        }
    </style>
</head>
<body>
    <div id="mapid"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Configuration flag to toggle between real data and dummy data
        const useDummyData = false;

        // Global variable to store the map object
        var mymap;

        /**
         * Generates dummy locations with names and random locations close to the user.
         * @param {number} userLat - The user's latitude.
         * @param {number} userLon - The user's longitude.
         * @returns {Object[]} An array of dummy location objects.
         */
        function generateDummyLocations(userLat, userLon) {
            const dummyLocations = [];
            const names = ["Ash", "Misty", "Brock", "Jessie", "James"];

            for (let i = 0; i < names.length; i++) {
                const randomLat = userLat + (Math.random() - 0.5) * 0.01; // Adding random noise
                const randomLon = userLon + (Math.random() - 0.5) * 0.01;
                dummyLocations.push({
                    latitude: randomLat,
                    longitude: randomLon,
                    user_id: names[i]
                });
            }

            return dummyLocations;
        }

        /**
         * Fetches the nearest locations from the API or uses dummy data.
         * Adds markers for these locations to the map.
         * @param {string} userId - The ID of the user (unused when using dummy data).
         * @param {number} userLat - The user's latitude.
         * @param {number} userLon - The user's longitude.
         */
        function fetchAndAddNearestLocations(userId, userLat, userLon) {
            if (useDummyData) {
                console.log('Using dummy data for nearest locations.');
                const dummyData = generateDummyLocations(userLat, userLon);
                addMarkersToMap(dummyData);
            } else {
                // Insert the fetch logic here for real data as previously defined
                console.log('Fetching real data (logic not shown here).');
            }
        }

        /**
         * Initializes the map and requests the user's location.
         */
        function setupMap() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(position => {
                    const userLat = position.coords.latitude;
                    const userLon = position.coords.longitude;

                    mymap = L.map('mapid').setView([userLat, userLon], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: 'Â© OpenStreetMap contributors'
                    }).addTo(mymap);

                    L.marker([userLat, userLon]).addTo(mymap).bindPopup("You are here").openPopup();

                    // Fetch and add markers for the nearest locations
                    fetchAndAddNearestLocations("user123", userLat, userLon);
                }, error => {
                    console.error("Geolocation error:", error);
                }, {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                });
            } else {
                console.log("Geolocation is not supported by this browser.");
            }
        }

        /**
         * Adds markers for a given list of locations to the map.
         * @param {Object[]} locations - An array of location objects.
         */
        function addMarkersToMap(locations) {
            locations.forEach(location => {
                L.marker([location.latitude, location.longitude])
                    .addTo(mymap)
                    .bindPopup(`User ID: ${location.user_id}`);
            });
        }

        setupMap(); // Start the process
    </script>
</body>
</html>
