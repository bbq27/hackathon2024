<!DOCTYPE html>
<html>
<head>
    <title>Find That Pokemon</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #mapid {
            height: 100vh; /* 100% of the viewport height */
            width: 100vw; /* 100% of the viewport width */
        }
    </style>
</head>
<body>
    <div id="mapid"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Fetching Locations from API
        function fetchAndFormatNearestLocations(userId, range, count) {
            fetch(`https://example.com/api/location/nearest?user_id=${userId}&range=${range}&count=${count}`)
                .then(response => response.json())
                .then(data => {
                    const formattedLocations = data.map(item => ({
                        lat: item.latitude,
                        lon: item.longitude,
                        userId: item.user_id
                    }));
                    return formattedLocations;
                })
                .catch(error => console.error('Failed to fetch locations:', error));
        }

        // Get location from user device
        var user_latitude;
        var user_longitude;
        function getLocation() {
            if ("geolocation" in navigator) {
                // Geolocation is supported, request the current position
                navigator.geolocation.getCurrentPosition(function(position) {
                    // Success callback
                    console.log("Latitude: " + position.coords.latitude);
                    console.log("Longitude: " + position.coords.longitude);

                    user_latitude = position.coords.latitude
                    user_longitude = position.coords.longitude

                    var mymap = L.map('mapid').setView([user_latitude, user_longitude], 13);

                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors'
                    }).addTo(mymap);
                    
                    L.marker([user_latitude, user_longitude])
                        .addTo(mymap)
                        .bindPopup("You")
                        .openPopup();
                }, function(error) {
                    // Error callback
                    console.error("Geolocation error: " + error.message);
                }, {
                    // Options (optional)
                    enableHighAccuracy: true, // Whether to request the device to use more precise methods to determine location
                    timeout: 5000, // Maximum time in milliseconds allowed for obtaining the position
                    maximumAge: 0 // Maximum age in milliseconds of a possible cached position that is acceptable to return
                });
            } else {
                // Geolocation isn’t supported, handle accordingly
                console.log("Geolocation is not supported by this browser.");
            }
        }
        getLocation()


        // Function for adding markets to map given list of locations
        function addMarkersToMap(locations) {
            locations.forEach(location => {
                L.marker([location.lat, location.lon]).addTo(mymap)
                    .bindPopup(`User ID: ${location.userId}`);
            });
        }

        //####################[ TESTING ]#############################################

        // Test locations for the pokemon
        var dummyLocations = [
            { lat: 40.7128, lon: -74.0060, userId: 'user1' },
            { lat: 40.7138, lon: -74.0010, userId: 'user2' },
            { lat: 40.7148, lon: -74.0050, userId: 'user3' },
            { lat: 40.7158, lon: -74.0000, userId: 'user4' },
            { lat: 40.7168, lon: -74.0020, userId: 'user5' }
        ];

        addMarkersToMap(dummyLocations)


    </script>
</body>
</html>
